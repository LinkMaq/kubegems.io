---
title: 快速安装
hide_title: true
sidebar_position: 1
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## 快速安装

---

**KubeGems Installer Operator**是一个通过 [Operator SDK](https://sdk.operatorframework.io/) 构建的Ansible Kubernetes控制器。通过CRD中的定义的字段对Ansible进行变量传递。Installer Operator的运行需要具备集群管理员的RBAC权限，所以在部署前需要联系您的集群管理员，以保证有足够的授权执行以下操作。

![](./assets/installer.jpg)

### Installation

1.执行以下命令安装KubeGems Installer控制器

<Tabs >
  <TabItem value="dockerhub" label="DockerHub 源" default>

```bash
KUBEGEMS_VERSION=v1.20.0-beta.2

kubectl apply -n kubegems-installer -f \
https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.yaml
```
  </TabItem>
  <TabItem value="aliyun" label="阿里云镜像源（中国大陆地区推荐）" default>

```bash
KUBEGEMS_VERSION=v1.20.0-beta.2

wget -O- https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.yaml \
| sed "s#image: kubegems#image: registry.cn-beijing.aliyuncs.com/kubegems#g"  \
| kubectl apply -f -
```
  </TabItem>
  <TabItem value="windows" label="GitHub 源" default>

```bash
KUBEGEMS_VERSION=v1.20.0-beta.2

wget -O- https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.yaml \
| sed "s#image: kubegems#image: ghcr.io/kubegems#g" \
| kubectl apply -f -
```
  </TabItem>
</Tabs >

2.执行以下命令验证部署结果

```bash
kubectl get pod -n kubegems-installer

NAME                                           READY   STATUS    RESTARTS   AGE     IP                NODE              NOMINATED NODE   READINESS GATES
kubegems-installer-manager-8649bd7fcb-j286g    2/2     Running   0          15m     192.169.15.92     k8s-master3-123   <none>           <none>
```

### Installer

1.执行以下命令提交 installer 资源

<Tabs >
  <TabItem value="dockerhub" label="DockerHub 源" default>

```bash
kubectl apply -f https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.installer.yaml
```
  </TabItem>
  <TabItem value="aliyun" label="阿里云镜像源（中国大陆地区推荐）" default>

```bash
wget -O - https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.installer.yaml \
| sed "s#repository: docker.io#repository: registry.cn-beijing.aliyuncs.com#g" \
| kubectl apply -f -
```
  </TabItem>
  <TabItem value="windows" label="GitHub 源" default>

```bash
wget -O - https://github.com/kubegems/installer-operator/releases/download/${KUBEGEMS_VERSION}/centrol.installer.yaml \
| sed "s#repository: docker.io#repository: ghcr.io#g" \
| kubectl apply -f -
```
  </TabItem>
</Tabs >

2.观察Installer部署状态

在提交CR后，可是使用以下命令观察installer的日志输出

```bash
kubectl logs -n kubegems-installer  <installer-operator容器> -c manager -f
```

指导出现类似下面日志，则表示初始化完成。

![](./assets/installer-complete.jpg)

3.运行以下命令进行部署验证

```
kubectl get pod --all-namespaces |grep gems
```
KubeGems部署完成后，会运行如下截图信息的容器
![](./assets/service-complete.jpg)

### 访问界面

当部署成功后，您可以在`gemcloud-gateway-system`命名空间下找到一个名叫 `deftault-gateway` 的网关，它由 KubeGems 自动创建。

```bash
kubectl get pod -n gemcloud-gateway-system
NAME                                                         READY   STATUS    RESTARTS   AGE
default-gateway-5bcb8bc59c-2fcq4                             1/1     Running   0          7d7h
nginx-ingress-operator-controller-manager-56bcddd997-kbjqw   2/2     Running   0          7d7h

kubectl get svc -n gemcloud-gateway-system
NAME                                                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
default-gateway                                             NodePort    10.102.206.7    <none>        80:32717/TCP,443:30557/TCP   7d7h
nginx-ingress-operator-controller-manager-metrics-service   ClusterIP   10.96.47.121    <none>        8443/TCP                     7d8h
nginx-ingress-operator-metrics                              ClusterIP   10.111.159.25   <none>        9113/TCP                     7d8h
```
您可以在创建一条ingress 规则将 kubegems dashboard 服务暴露出来，参考如下

```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    nginx.org/proxy-buffering: "false"
    nginx.org/websocket-services: gems-dashboard
  name: gems-dashboard
  namespace: gemcloud-system
spec:
  ingressClassName: default-gateway
  rules:
  - host: console.kubegems.io
    http:
      paths:
      - backend:
          serviceName: gems-dashboard
          servicePort: 8000
        path: /
        pathType: ImplementationSpecific
```

此时，您需要将域名`console.kubegems.io`解析到 Kubernetes 集群内任意节点后，即可通过 `http://console.kubegems.io:<NodePort>` 访问页面。

![](./assets/gems-first-dashbaord.jpg)

您可以通过如下用户名与密码登录控制台：

```
user: admin 
password: demo!@#admin
```

### 添加管理集群

使用 admin 身份登录 KubeGems 平台后，点击右下角 “工具” 图标，进入【平台管理】，点击 “添加集群”。

:::info
初次安装完成后，KubeGems 内无集群数据，需要用户自信将当前集群添加到 KubeGems 当中。
:::

- 将您的 kubeconfig 内容粘贴至文本框，点击“下一步”

![](./assets/gems-first-centrol-cluster.jpg)

- 当 kubeconfig 校验成功，您可以看到如下界面后，点击“下一步”

<img
  src={require('./assets/cluster-check-success.jpg').default}
  alt="Example banner"
  width="80%"
  align="center"
/>

- 勾选 “控制集群”，并端着控制集群中的一些基本信息，如“镜像仓库”、“存储类型”等。

<img
  src={require('./assets/gems-first-centrol-info.jpg').default}
  alt="Example banner"
  width="80%"
  align="center"
/>

:::caution
如无法确定如何选择上述信息，保持默认即可。
:::

- 提交保存成功，您在“集群资源”页面即可看到新加的控制集群。

![](./assets/gems-first-centrol.jpg)

- 点击控制集群的“详情”，即可看到集群的详细信息。

![](./assets/gems-first-centrol-dash.jpg)


:::tip
想更进一步了解 KubeGems 使用 ?
请跳转至 [快速开始](/docs/quick-starts/quick-start) 开始学习。
:::

### 附录 

#### 系统命名空间

| 命名空间 | 用途 |
| --- | --- |
| cert-manager | 证书管理所在空间,KubeGems 安装过程中会向 cert-manager 申请 tls 证书 |
| kubegems-installer | KubeGems installer  operator 所在空间 |
| gemcloud-system| KubeGems 系统核心服务所在空间|
| gemcloud-monitoring-system| KubeGems 监控告警服务所在空间 |
| gemcloud-logging-system| KubeGems 日志服务所在空间 |
| gemcloud-gateway-system| KubeGems 租户Ingress网关和 Istio 网关所在空间 |
| gemcloud-workflow-system | KubeGems 持续部署引擎 ArgoCD 所在空间 |
| observability | KubeGems Jaeger 应用链路跟踪服务所在空间 |
| istio-system |  Kubegems istio 服务治理套件所在空间 |
| local-path-storage |  local-path-provisioner所在空间，用于创建本地文件系统的 pvc |
